//Copyright (c) Takashi Ito 2018
//Twitter: @syatchIT
//github: https://github.com/syatch#include
#include <IRremote.h>
#include <IRremoteInt.h>
#include <SoftwareSerial.h>

SoftwareSerial LazSerial(12,13);//rx,tx
IRsend irsend;

char rxbuf[128];

enum{
 TV =0,
 FAN,
 LIHGHT,
 AIR,
 MAX_MN,  
};

uint8_t TVCommand[20][99]={
  //power
  {175,35,55,30,140,40,45,40,50,35,50,40,45,35,50,35,55,35,50,35,50,40,45,40,45,35,55,30,135,45,45,40,45,40,50,35,50,30,55,35,50,40,45,40,50,35,50,40,130,35,55,35,50,35,50,40,45,40,45,35,55,30,55,40,45,40,130,40,50,35,135,35,135,35,135,45,130,35,55,35,50,40,130,40,45,40,130,45,130,40,130,40,135,35,50,40,130,35},
  //1
  {170,45,45,40,125,50,40,45,40,45,45,40,45,45,40,45,40,45,45,40,45,40,45,45,40,45,40,45,125,50,40,45,40,45,40,45,45,40,45,45,40,45,40,45,45,40,45,40,125,50,125,45,45,40,45,45,125,45,45,40,45,45,40,45,40,45,40,45,45,40,45,45,40,45,40,45,45,40,125,50,40,45,125,45,45,45,40,45,125,45,45,40,45,45,125,45,125,45},
  //2
  {170,45,45,40,125,50,40,45,45,40,45,40,45,45,40,45,40,40,50,35,50,40,45,45,40,45,40,40,130,45,45,40,45,40,45,40,50,35,50,40,45,40,45,40,50,35,50,40,125,45,130,40,50,40,45,40,130,40,50,35,50,40,45,40,45,40,130,40,50,40,45,40,45,40,50,35,50,40,125,45,45,40,50,35,50,40,45,40,130,40,50,35,50,40,130,40,130,45},
  //3
  {170,45,45,40,130,45,45,40,45,40,45,45,45,40,45,40,45,40,45,40,50,40,45,40,45,40,45,40,130,45,45,40,45,40,45,40,45,45,45,35,50,40,45,40,45,35,55,35,130,40,135,40,50,35,50,35,130,40,50,45,45,35,50,35,50,35,50,35,135,40,50,35,50,35,50,35,55,35,130,40,50,35,135,40,130,40,50,40,130,45,45,35,50,40,130,45,125,45},
  //4
  {180,35,55,30,140,35,55,30,55,30,55,30,60,30,55,30,55,30,55,30,60,30,55,30,55,30,55,30,140,35,55,30,55,30,55,30,55,30,60,30,55,30,55,30,55,30,60,30,135,35,140,30,60,30,55,30,135,35,55,30,60,30,55,30,55,30,140,35,135,40,50,30,55,30,60,30,55,30,135,40,50,40,50,30,135,40,50,30,140,40,50,30,55,30,140,40,130,35},
  //5
  {180,35,60,25,140,30,60,30,55,30,60,25,60,25,55,35,55,30,55,30,55,30,55,30,60,30,55,30,135,35,55,30,60,30,55,30,60,25,55,30,55,35,55,30,55,30,55,30,140,35,135,35,55,30,55,30,140,35,55,30,60,25,55,35,55,30,55,30,55,30,140,35,55,30,55,30,55,30,140,35,55,30,135,35,60,30,135,35,135,35,60,30,55,30,135,35,140,35},
  //6
  {185,30,60,35,130,35,55,30,55,40,50,30,55,30,55,35,50,35,50,40,50,30,55,35,50,30,55,35,135,40,50,35,50,30,55,30,60,30,55,30,55,30,55,35,50,40,50,30,135,35,135,40,55,30,55,30,140,30,60,30,55,30,55,30,60,25,140,35,55,30,140,30,60,30,55,30,55,30,140,30,60,30,55,30,60,25,140,30,140,35,60,25,55,30,135,40,135,35},
  //7
  {175,35,55,30,135,40,50,35,50,35,55,30,55,30,55,35,50,35,55,30,55,30,55,30,55,45,40,45,125,45,45,40,45,35,50,35,55,40,45,35,50,35,50,40,45,45,45,40,125,40,135,40,50,40,45,35,135,35,55,35,50,35,50,35,50,35,50,45,125,45,130,35,55,40,40,40,50,35,135,35,55,35,130,40,135,35,135,40,135,35,55,35,50,40,125,45,130,45},
  //8
  {175,45,45,35,130,45,45,45,45,35,50,35,50,40,45,40,50,35,50,40,45,35,50,35,50,35,55,35,130,40,50,35,50,40,50,30,55,30,55,35,50,35,50,35,55,30,55,30,140,35,135,35,55,35,50,35,135,35,55,30,55,35,50,35,55,30,135,35,140,35,135,35,55,35,50,35,50,35,135,35,55,35,50,35,135,35,135,40,135,35,55,30,55,35,135,35,135,35},
  //9
  {175,40,50,40,130,40,50,40,45,40,45,40,45,40,45,35,55,40,45,40,45,40,45,35,50,35,55,35,130,45,45,40,45,45,45,35,50,35,50,35,50,35,55,35,50,35,50,35,135,45,125,45,45,35,50,40,130,45,45,35,50,35,50,40,50,35,50,35,50,35,50,35,135,45,45,35,50,35,130,45,50,35,130,40,50,35,55,35,50,35,50,35,50,35,135,40,130,40},
  //10
  {170,40,50,40,125,40,50,40,50,40,45,40,40,40,50,40,45,45,45,40,45,40,45,40,45,35,55,35,130,40,50,40,45,40,50,40,45,40,45,40,45,35,50,45,45,35,50,35,135,40,130,45,45,40,45,40,130,45,45,40,45,40,45,40,45,40,130,45,45,40,45,40,130,45,45,40,45,40,130,45,45,40,45,40,45,40,45,40,50,40,45,40,45,40,130,45,125,45},
  //11
  {175,40,50,35,135,35,55,35,50,35,50,35,50,35,55,35,50,35,50,35,50,35,50,40,50,40,40,40,130,45,45,40,50,40,45,40,40,45,45,40,45,45,45,40,45,40,45,40,130,45,125,45,45,40,45,40,130,45,45,40,45,40,45,35,55,40,45,40,130,40,45,40,130,45,45,35,50,40,130,45,45,35,135,45,125,40,50,35,50,35,55,35,50,35,130,40,135,40},
  //12
  {170,40,50,45,125,45,45,40,45,40,45,45,45,40,45,40,45,40,45,40,50,40,45,40,45,40,45,35,135,45,45,40,45,35,50,40,45,35,55,40,40,40,50,35,50,40,50,35,130,40,135,35,55,40,45,40,130,40,45,40,50,35,45,40,50,35,135,45,125,40,50,40,130,45,40,40,50,40,130,45,45,40,45,35,135,40,45,40,50,35,50,40,40,45,130,45,125,45},
   //Volume up
  {175,40,50,40,130,40,50,35,50,40,45,40,45,40,45,40,50,35,50,40,45,40,45,40,50,35,50,35,130,45,45,40,45,40,50,35,50,40,45,40,45,40,50,35,50,35,50,40,130,40,45,40,50,40,45,40,45,40,50,35,50,35,50,40,45,40,45,40,50,35,50,35,50,40,45,40,130,40,50,35,50,40,45,40,50,35,50,35,50,40,45,40,135,35,50,35,130,45},
  //Volume down
  {180,35,55,30,135,40,50,35,50,35,55,35,50,30,55,35,50,35,55,30,55,30,50,40,50,40,45,35,135,35,55,35,50,35,50,35,55,30,55,30,55,35,50,35,55,30,55,30,135,40,50,35,55,30,55,30,55,35,50,35,50,35,55,30,55,30,135,40,55,30,55,30,55,30,55,35,135,35,55,30,55,35,135,35,55,30,55,30,55,35,50,35,135,35,55,30,140,35},
  //mute
  {170,40,50,35,135,40,50,35,50,40,45,35,55,35,50,35,50,40,45,35,50,35,55,35,45,40,50,35,135,40,50,40,45,40,45,40,45,40,50,40,45,40,45,40,45,40,45,40,130,45,45,35,50,35,50,40,50,35,50,35,50,35,50,35,55,35,50,35,130,40,50,35,55,35,130,40,135,35,55,35,50,35,50,35,135,40,50,35,50,35,135,35,135,40,50,35,135,35},
  //list
  {170,45,45,40,135,40,45,40,45,40,45,40,50,40,45,35,50,40,45,40,45,35,55,40,45,40,40,45,130,45,45,40,45,35,50,35,50,35,55,35,45,40,50,35,45,40,50,35,135,40,130,45,45,35,50,40,50,35,50,35,50,35,55,35,50,35,50,35,50,35,50,35,55,35,50,35,50,35,135,35,55,35,130,40,50,35,50,35,50,40,50,35,50,35,135,40,130,40},
  //Chanup
  {175,40,50,35,135,40,50,35,50,35,50,35,50,40,45,40,50,35,50,35,50,35,50,40,50,35,50,35,135,35,50,40,50,30,55,35,50,35,50,40,45,40,50,35,50,35,50,35,135,40,50,35,50,35,50,35,50,40,50,35,50,35,50,35,50,35,50,40,50,35,130,40,50,40,130,40,130,40,50,40,50,35,50,35,50,30,140,40,50,35,130,40,135,40,50,35,130,40},
  //Chandown
  {175,40,50,35,135,45,45,40,45,40,45,35,55,35,50,35,50,35,50,35,55,35,50,35,45,40,50,35,135,40,50,40,45,35,50,35,50,35,55,35,50,35,50,35,50,35,55,35,130,40,50,40,45,35,55,35,50,35,50,35,50,35,50,35,55,35,130,40,50,40,130,40,50,35,135,35,135,45,45,35,50,35,135,40,50,40,125,40,50,35,135,40,135,45,45,40,125,45},
  //ChanChange
  {170,40,50,35,135,45,45,40,45,35,50,35,55,40,45,40,40,40,50,35,50,40,50,35,50,35,50,40,130,40,50,35,50,40,45,35,50,35,50,40,50,40,45,35,50,35,50,40,130,40,50,40,45,40,45,40,45,35,55,40,45,40,45,35,50,35,135,40,50,40,125,40,50,45,45,35,50,40,45,35,50,35,135,40,50,40,130,40,45,35,55,35,50,40,45,40,130,40},
};

uint8_t FANCommand[8][67]{
  //power
  {190,50,40,50,50,45,50,45,50,40,140,45,145,45,135,50,45,45,140,45,145,45,140,45,50,40,140,50,45,50,45,50,45,45,140,50,45,50,45,50,45,45,50,45,45,45,145,45,45,50,45,45,145,40,145,45,45,45,145,45,40,50,50,45,140,45},
  //rhythm
  {185,50,45,45,50,45,45,50,45,45,145,40,145,40,145,45,45,45,140,45,145,40,145,45,45,45,145,45,45,50,45,45,50,45,140,45,45,50,45,50,45,50,45,50,45,45,140,45,45,50,50,45,45,50,45,50,45,45,140,45,140,45,140,45,140,50},
  //stronger
  {185,50,50,45,45,50,45,50,45,45,140,50,135,50,140,45,50,45,135,50,135,50,140,45,50,45,140,55,45,45,50,45,50,45,140,50,45,45,45,50,50,45,45,50,50,45,140,55,45,45,50,45,50,45,145,45,145,45,145,50,135,50,45,50,45,40},
  //weaker
  {190,45,50,45,50,45,50,40,55,40,145,40,140,45,145,40,50,45,145,40,145,40,145,40,50,40,145,45,50,45,50,45,50,40,145,45,50,40,50,45,50,45,50,45,50,40,145,45,50,40,50,45,145,40,50,40,145,40,145,45,50,40,145,45,50,45},
  //updown
  {190,45,50,45,50,40,55,40,50,40,145,40,145,40,145,45,55,35,145,40,145,40,145,45,55,35,145,45,50,40,55,40,50,45,140,45,50,45,50,45,50,40,55,40,50,40,145,45,50,40,145,40,145,45,50,40,145,45,50,40,55,40,140,45,50,45},
  //leftright
  {185,50,50,40,50,45,50,45,50,40,140,45,145,40,145,45,50,40,145,40,140,45,145,45,50,40,145,45,50,40,55,40,50,40,145,45,50,45,50,45,50,40,50,45,50,40,140,50,50,45,50,40,145,40,140,45,145,40,145,45,50,40,50,45,50,45},
  //timeon
  {185,55,45,45,50,45,45,50,45,45,140,45,140,45,140,50,45,45,140,45,140,45,140,50,45,45,140,50,45,50,45,45,45,50,135,50,45,50,45,50,45,50,45,45,45,50,135,50,50,45,135,50,45,50,45,50,45,50,45,45,135,50,135,50,135,50},
  //timeoff
  {190,45,50,40,55,40,50,45,50,40,145,40,145,40,145,45,50,40,145,40,145,40,145,45,50,40,145,45,50,40,50,45,50,40,145,45,50,45,50,40,55,40,50,45,50,40,145,45,50,45,50,45,50,40,50,45,140,45,140,45,140,45,145,40,50,45},
};


uint8_t LIGHTCommand[8][83]={
  //poweron
  {170,45,45,40,50,35,125,50,125,45,45,40,130,40,50,35,50,40,45,40,125,45,45,40,45,40,130,40,50,35,135,40,45,35,135,40,45,40,45,40,130,40,50,40,45,40,45,40,45,40,130,40,45,40,130,40,135,40,45,40,130,40,45,40,45,40,50,35,50,35,130,45,45,40,45,40,125,45,45,40,45,40},
  //poweroff
  {175,40,50,35,50,35,135,40,130,40,50,35,130,40,50,35,50,35,50,40,130,40,50,35,50,35,130,40,50,35,135,40,45,40,130,40,50,35,50,35,130,40,50,35,50,40,45,40,50,35,130,40,130,40,135,35,135,40,50,35,130,40,45,40,50,35,50,35,135,40,130,40,45,40,45,40,130,40,50,35,50,35},
  //brighter
  {170,40,50,40,45,40,125,40,135,35,50,40,130,40,50,35,50,40,40,40,130,40,50,40,45,35,135,40,50,40,125,45,45,35,135,35,50,35,55,30,135,40,45,40,45,45,45,40,45,40,45,35,135,40,50,35,130,40,50,35,135,35,50,40,45,40,130,40,130,45,45,40,45,35,50,35,135,35,55,40,40,40},
  //darker
  {180,35,50,35,50,35,135,35,135,40,50,35,130,40,45,40,45,40,50,35,130,40,50,40,45,35,130,45,45,40,130,40,50,35,130,45,45,40,45,40,130,40,45,35,55,35,50,35,50,35,130,45,130,40,45,40,130,40,50,30,135,35,55,35,50,35,50,35,135,35,55,35,50,40,45,40,125,45,45,35,50,40},
  //whiter
  {170,45,45,40,45,40,125,50,125,45,45,40,125,45,50,35,50,35,50,40,120,50,45,40,45,40,130,40,50,35,130,45,45,40,125,45,45,40,45,40,130,40,130,45,130,40,45,40,45,40,45,40,45,40,50,30,55,35,135,40,45,40,45,40,130,40,130,40,50,35,50,40,120,50,45,40,125,45,50,35,125,45},
  //warmer
  {170,35,50,35,55,35,130,45,125,40,50,35,135,35,55,35,45,40,45,40,130,40,50,40,45,40,130,40,50,40,125,45,45,40,125,45,45,40,45,40,130,45,125,45,125,45,45,40,45,40,130,40,50,35,45,45,45,35,130,40,50,35,50,35,135,40,50,35,50,35,50,35,130,40,50,35,135,35,55,35,130,40},
  //nightlight
  {175,40,45,40,45,45,125,45,130,40,45,35,135,40,45,40,45,40,45,45,130,35,50,40,45,40,130,40,45,40,130,45,45,40,130,35,50,40,45,40,130,40,45,40,45,40,45,45,45,40,45,35,135,40,130,40,130,45,40,45,130,40,45,35,50,40,130,40,130,35,140,35,50,35,50,35,135,40,45,40,45,40},
  //alllight
  {175,40,50,35,50,35,135,35,135,40,50,30,140,35,50,35,50,35,50,35,140,30,55,30,55,30,135,40,50,35,135,35,50,35,140,30,55,30,55,30,140,35,50,35,50,35,55,30,55,30,55,30,55,30,140,35,135,35,50,35,140,30,55,30,55,30,140,35,50,35,135,35,55,30,55,30,135,35,55,35,50,35},
};


uint8_t AIRCommand[4][99]={
  //cooler on
  {155,45,40,45,35,45,115,45,35,45,115,45,40,45,35,45,35,45,115,45,120,45,35,45,35,45,35,45,115,45,120,45,35,45,35,45,40,40,35,45,35,45,40,45,35,45,35,45,35,40,40,45,35,45,40,45,35,45,115,45,35,45,35,45,40,40,40,45,35,45,35,45,35,45,115,45,40,45,35,45,35,45,35,45,115,45,120,45,115,45,115,45,120,45,115,45,115,45,115},
  //warmer on
  {160,45,40,40,35,45,115,45,40,40,120,45,35,45,40,40,40,35,120,45,120,45,35,45,40,40,40,40,120,45,115,45,40,40,40,40,40,40,35,45,45,40,35,45,35,45,40,40,40,40,40,40,40,45,40,40,40,40,115,45,40,40,40,45,35,45,40,40,40,40,40,40,40,40,120,45,35,45,35,45,40,40,40,40,120,45,115,45,115,45,120,45,115,45,115,45,115,45,120},
  //auto on
  {160,45,40,40,35,45,115,45,40,40,120,45,35,45,40,40,40,35,120,45,120,45,35,45,40,40,40,40,120,45,115,45,40,40,40,40,40,40,35,45,45,40,35,45,35,45,40,40,40,40,40,40,40,45,40,40,40,40,115,45,40,40,40,45,35,45,40,40,40,40,40,40,40,40,120,45,35,45,35,45,40,40,40,40,120,45,115,45,115,45,120,45,115,45,115,45,115,45,120},
  //off
  {165,40,45,30,50,35,125,35,50,30,125,35,50,30,55,35,45,35,125,30,130,30,50,30,55,35,45,35,120,35,130,35,50,30,50,30,50,35,45,30,50,35,45,35,45,35,50,25,55,35,45,35,45,35,45,30,50,30,130,35,50,35,45,35,45,35,45,35,45,40,45,35,45,35,120,40,45,30,50,35,50,25,55,30,130,35,125,30,130,40,120,35,130,30,135,25,135,35,125},
};
  
void sendCommand(uint8_t *raw,int num){
  unsigned int cmd[num];
  cmd[0]=3400;
  for(int re=0;re<num-1;re++){
      cmd[re+1]=raw[re]*10;
  }
  int khz = 38; 
  for(int tx=0;tx<3;tx++){
    irsend.sendRaw(cmd, sizeof(cmd) / sizeof(cmd[0]), khz);
    delay(50); 
  } 
}

void sendTVCommand(int TVcommandnum){
  sendCommand(TVCommand[TVcommandnum],99);
}


void sendFANCommand(int FANcommandnum){
  sendCommand(FANCommand[FANcommandnum],67);
}


void sendLIGHTCommand(int LIGHTcommandnum){
  sendCommand(LIGHTCommand[LIGHTcommandnum],83);
}

void sendAIRCommand(int AIRcommandnum){
  sendCommand(AIRCommand[AIRcommandnum],99);
}

typedef struct{
 void (*irsend)(int);
}IRCmd;


IRCmd CmdTable[MAX_MN]{
  {sendTVCommand},
  {sendFANCommand},
  {sendLIGHTCommand},
  {sendAIRCommand},
};


void setup(){
  LazSerial.begin(9600);
}

void loop() {
  int i=0;
  bool serial_state=false;
  while(LazSerial.available()){
    rxbuf[i]=LazSerial.read();
    i++;
    serial_state=true;
    delay(10);
  }
  if(serial_state==true){
    if(int(rxbuf[0]-65)==1){
      CmdTable[int(rxbuf[1]-65)].irsend(int(rxbuf[2]-65));
    }
    else{
    }
  }
  for(int j=0;j<i;j++){
    rxbuf[j]='\0';
  }
}
